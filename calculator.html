<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scientific Calculator — Mudit Narayan Soni</title>
  <style>
    :root{
      --bg-1:#041428; --bg-2:#071b2f;
      --muted: rgba(255,255,255,0.65);
      --accent1:#8b5cf6; --accent2:#06bdf5; --danger:#ff7185;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial;color:#fff;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));display:flex;align-items:center;justify-content:center;padding:28px}
    .calc-shell{width:100%;max-width:480px}
    .calculator{background:linear-gradient(180deg,rgba(255,255,255,0.015),rgba(255,255,255,0.01));padding:18px;border-radius:20px;border:1px solid rgba(255,255,255,0.03);backdrop-filter:blur(6px);box-shadow:0 12px 34px rgba(2,6,23,0.6)}
    .calc-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .title{font-weight:700;font-size:16px} .sub{font-size:12px;color:var(--muted)}
    .display-wrap{background:linear-gradient(180deg,rgba(255,255,255,0.012),rgba(255,255,255,0.01));padding:12px;border-radius:12px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03)}
    #display{width:100%;background:transparent;border:none;outline:none;color:#fff;font-size:28px;text-align:right;font-weight:600;caret-color:var(--accent2)}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:10px}
    .toggle{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:10px;cursor:pointer}
    .mem-ind{color:var(--muted);font-size:13px;margin-left:8px}

    /* Scientific panel (hidden by default) */
    .scientific{
      display:none;
      margin-bottom:12px;
      gap:10px;
      grid-template-columns: repeat(6, 1fr);
      align-items:stretch;
    }
    .scientific.show{display:grid}

    /* keypad */
    .pad{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:12px;
      grid-auto-rows:62px;
      grid-auto-flow:dense; /* allow placement by grid-column/grid-row */
    }

    .btn{
      border:none;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.005));
      color:#e6eef7;font-weight:700;font-size:18px;cursor:pointer;box-shadow:0 8px 18px rgba(2,6,23,0.55),inset 0 -6px 12px rgba(0,0,0,0.45);
      display:flex;align-items:center;justify-content:center;position:relative;user-select:none;transition:transform .08s ease,box-shadow .12s ease;
    }
    .btn:hover{transform:translateY(-4px);box-shadow:0 16px 30px rgba(2,6,23,0.6)}
    .btn:active{transform:translateY(1px);box-shadow:none}

    .btn-op{background:linear-gradient(180deg,rgba(12,75,190,0.06),rgba(124,58,237,0.06));border:1px solid rgba(124,58,237,0.12)}
    .btn-clear{background:linear-gradient(180deg,rgba(255,114,140,0.14),rgba(255,114,140,0.08));border:1px solid rgba(255,114,140,0.12);color:#ffe6ea}
    .btn-equal{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;border:none;box-shadow:0 18px 40px rgba(6,189,245,0.14)}
    .btn-zero{text-align:left;padding-left:18px}
    /* place equal bottom-left spanning 2 cols */
    .btn-equal{grid-column:1 / span 2; grid-row:5}

    /* place zero and dot to the right of equal */
    .btn-zero{grid-column:3 / span 1; grid-row:5}
    .btn-dot{grid-column:4 / span 1; grid-row:5}

    /* small screens adjust */
    @media(max-width:420px){
      .pad{grid-auto-rows:56px}
      .btn{font-size:16px}
      .btn-equal{grid-row: auto; grid-column: 1 / span 2; height:56px}
    }

    /* scientific button look */
    .s-btn{height:44px;border-radius:10px;font-weight:600;font-size:13px;padding:6px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.007));border:1px solid rgba(255,255,255,0.03);color:#eaf2ff;cursor:pointer}
    .s-row{display:contents}
  </style>
</head>
<body>
  <div class="calc-shell">
    <div class="calculator">
      <div class="calc-header">
        <div>
          <div class="title">Online Calculator</div>
          <div class="sub">By — Mudit Narayan Soni</div>
        </div>
        <div style="display:flex;align-items:center">
          <button id="sciToggle" class="toggle" aria-pressed="false">Show Scientific</button>
          <div class="mem-ind" id="memIndicator"></div>
        </div>
      </div>

      <div class="display-wrap">
        <input id="display" inputmode="text" autocomplete="off" />
      </div>

      <div id="scientificPanel" class="scientific" aria-hidden="true">
        <!-- six columns width, wrap automatically -->
        <button class="s-btn" data-fn="sin(">sin</button>
        <button class="s-btn" data-fn="cos(">cos</button>
        <button class="s-btn" data-fn="tan(">tan</button>
        <button class="s-btn" data-fn="asin(">asin</button>
        <button class="s-btn" data-fn="acos(">acos</button>
        <button class="s-btn" data-fn="atan(">atan</button>

        <button class="s-btn" data-fn="ln(">ln</button>
        <button class="s-btn" data-fn="log(">log</button>
        <button class="s-btn" data-fn="Math.exp(">exp</button>
        <button class="s-btn" data-fn="Math.pow(">x^y</button>
        <button class="s-btn" data-fn="Math.sqrt(">√</button>
        <button class="s-btn" data-fn="abs(">abs</button>

        <button class="s-btn" data-fn="pi">π</button>
        <button class="s-btn" data-fn="e">e</button>
        <button class="s-btn" data-fn="(">(</button>
        <button class="s-btn" data-fn=")">)</button>
        <button class="s-btn" data-fn="!">x!</button>
        <button class="s-btn" data-fn="%">%</button>
      </div>

      <div class="controls" style="margin-bottom:10px">
        <button id="mplus" class="toggle">M+</button>
        <button id="mr" class="toggle">MR</button>
        <button id="mc" class="toggle">MC</button>
        <div style="flex:1"></div>
        <small style="color:var(--muted)">Enter =, C to clear</small>
      </div>

      <div class="pad" id="pad" aria-label="calculator keypad">
        <!-- row1 -->
        <button class="btn btn-clear" data-action="clear">C</button>
        <button class="btn" data-action="back">⌫</button>
        <button class="btn" data-value="00">00</button>
        <button class="btn btn-op" data-value="/">÷</button>

        <!-- row2 -->
        <button class="btn" data-value="7">7</button>
        <button class="btn" data-value="8">8</button>
        <button class="btn" data-value="9">9</button>
        <button class="btn btn-op" data-value="*">×</button>

        <!-- row3 -->
        <button class="btn" data-value="4">4</button>
        <button class="btn" data-value="5">5</button>
        <button class="btn" data-value="6">6</button>
        <button class="btn btn-op" data-value="-">−</button>

        <!-- row4 -->
        <button class="btn" data-value="1">1</button>
        <button class="btn" data-value="2">2</button>
        <button class="btn" data-value="3">3</button>
        <button class="btn btn-op" data-value="+">+</button>

        <!-- bottom row: = (big left), 0, . -->
        <button class="btn btn-equal" data-action="equals">=</button>
        <button class="btn btn-zero" data-value="0">0</button>
        <button class="btn btn-dot" data-value=".">.</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const display = document.getElementById('display');
    const pad = document.getElementById('pad');
    const sciToggle = document.getElementById('sciToggle');
    const sciPanel = document.getElementById('scientificPanel');
    const mplus = document.getElementById('mplus');
    const mr = document.getElementById('mr');
    const mc = document.getElementById('mc');
    const memIndicator = document.getElementById('memIndicator');
    let memory = null;

    // helpers
    function log10(x){ return Math.log(x)/Math.LN10; }
    function fact(n){
      n = Number(n);
      if (!Number.isFinite(n) || n < 0) return NaN;
      if (Math.floor(n) !== n) return NaN;
      if (n === 0 || n === 1) return 1;
      let r = 1;
      for (let i=2;i<=n;i++) r *= i;
      return r;
    }

    // toggle scientific
    sciToggle.addEventListener('click', () => {
      const on = !sciPanel.classList.contains('show');
      sciPanel.classList.toggle('show', on);
      sciPanel.style.display = on ? 'grid' : 'none';
      sciToggle.textContent = on ? 'Hide Scientific' : 'Show Scientific';
      sciToggle.setAttribute('aria-pressed', on ? 'true' : 'false');
      display.focus();
    });

    // click handling (pad + scientific + memory)
    document.addEventListener('click', (ev) => {
      const btn = ev.target.closest('button');
      if (!btn) return;

      // scientific buttons
      if (btn.dataset.fn !== undefined) {
        const fn = btn.dataset.fn;
        if (fn === 'pi') { display.value += String(Math.PI); return; }
        if (fn === 'e') { display.value += String(Math.E); return; }
        if (fn === '!') { display.value += '!'; return; }
        if (fn === '%') { display.value += '%'; return; }
        display.value += fn;
        display.focus();
        return;
      }

      // memory
      if (btn.id === 'mplus') {
        try {
          const v = safeEval(display.value);
          if (!Number.isFinite(v)) { alert('Cannot store this value'); return; }
          memory = v;
          memIndicator.textContent = 'M';
        } catch(e){ alert('Invalid expression'); }
        return;
      }
      if (btn.id === 'mr') {
        if (memory === null) return;
        display.value += String(memory);
        return;
      }
      if (btn.id === 'mc') {
        memory = null; memIndicator.textContent = ''; return;
      }

      // pad buttons
      const action = btn.dataset.action;
      const val = btn.dataset.value;
      if (action === 'clear') { display.value = ''; return; }
      if (action === 'back') { display.value = display.value.slice(0,-1); return; }
      if (action === 'equals') { evaluate(); return; }
      if (val !== undefined) { display.value += val; return; }
    });

    // keyboard allowances
    display.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); evaluate(); return; }
      if (e.key === 'c' || e.key === 'C') { display.value = ''; e.preventDefault(); return; }
      if (['Backspace','Delete','ArrowLeft','ArrowRight','Tab'].includes(e.key)) return;
      // allow digits, ops, parentheses, dot and letters used by functions
      const allowed = '0123456789+-*/().^%!%';
      const allowedLetters = 'sincostanlgpexab'; // rough
      if (allowed.includes(e.key)) return;
      if (allowedLetters.includes(e.key.toLowerCase())) return;
      e.preventDefault();
    });

    // Evaluate wrapper
    function evaluate(){
      const expr = display.value.trim();
      if (!expr) return;
      try {
        const res = safeEval(expr);
        display.value = String(res);
      } catch(e) {
        display.value = 'Error';
      }
    }

    // Safe evaluator adapted to scientific tokens
    function safeEval(input){
      if (!input) return 0;
      // reject suspicious chars
      if (/[^0-9+\-*/%^().,%! eEasincotlgbprxMathlog10abs]/i.test(input)) {
        // allow letters used; keep this general but protected later
        // for safety throw if suspicious pattern found
      }

      let expr = input;

      // percentage after number or ) -> (n/100)
      expr = expr.replace(/(\d+(\.\d+)?|\))%/g, '($1/100)');

      // replace unicode multiply/div signs if any
      expr = expr.replace(/×/g, '*').replace(/÷/g, '/').replace(/−/g, '-');

      // factorial handling: convert n! or (expr)! to fact(...)
      expr = replaceFactorials(expr);

      // replace friendly names with JS/Math equivalents
      expr = expr.replace(/\bln\(/g, 'Math.log(');
      expr = expr.replace(/\blog\(/g, 'log10(');
      expr = expr.replace(/\bexp\(/g, 'Math.exp(');
      expr = expr.replace(/\babs\(/g, 'Math.abs(');

      expr = expr.replace(/\basin\(/g, 'Math.asin(');
      expr = expr.replace(/\bacos\(/g, 'Math.acos(');
      expr = expr.replace(/\batan\(/g, 'Math.atan(');

      expr = expr.replace(/\bsin\(/g, 'Math.sin(');
      expr = expr.replace(/\bcos\(/g, 'Math.cos(');
      expr = expr.replace(/\btan\(/g, 'Math.tan(');

      expr = expr.replace(/\^/g, '**');

      // pi and e tokens (word boundaries)
      expr = expr.replace(/\bpi\b/gi, String(Math.PI));
      // only replace standalone e (avoid changing 'exp' etc) -> use regex \be\b with spaces or boundaries
      expr = expr.replace(/\be\b/g, String(Math.E));

      if (expr.includes('__') || expr.includes('constructor')) throw new Error('Unsafe');

      // evaluate with helper functions in closure
      const f = new Function('log10','fact','Math','return (' + expr + ')');
      return f(log10, fact, Math);
    }

    // factorial replacement utility
    function replaceFactorials(s){
      let out = s;
      let idx = out.indexOf('!');
      while (idx !== -1){
        let i = idx - 1;
        if (i < 0) break;
        if (out[i] === ')'){
          // find matching '('
          let depth = 0, j = i;
          for (; j >= 0; j--){
            if (out[j] === ')') depth++;
            else if (out[j] === '('){
              depth--;
              if (depth === 0) break;
            }
          }
          if (j < 0) throw new Error('Mismatched parentheses in factorial');
          const inner = out.slice(j, idx); // includes parentheses
          out = out.slice(0, j) + 'fact' + inner + out.slice(idx+1);
          idx = out.indexOf('!', j + 5);
        } else {
          // number to left
          let j = i;
          while (j >= 0 && /[0-9.]/.test(out[j])) j--;
          const start = j+1;
          const num = out.slice(start, idx);
          if (num.length === 0) throw new Error('Bad factorial operand');
          out = out.slice(0, start) + 'fact(' + num + ')' + out.slice(idx+1);
          idx = out.indexOf('!', start + 6);
        }
      }
      return out;
    }

    // safe helpers
    function log10(x){ return Math.log(x)/Math.LN10; }
    function fact(n){
      n = Number(n);
      if (!Number.isFinite(n) || n < 0) return NaN;
      if (Math.floor(n) !== n) return NaN;
      if (n === 0 || n === 1) return 1;
      let res = 1;
      for (let i=2;i<=n;i++) res *= i;
      return res;
    }

    // expose for debugging (optional)
    window._calc = {safeEval, fact, log10};

  })();
  </script>
</body>
</html>
